# ========================
# Delivery Lots Components
# ========================

components:

  schemas:

    delivery_lot_base:
      description: Base Delivery Lot Entity Definition
      type: object
      properties:
        vehicle_limits:
          description: Vehicle restrictions
          type: object
          properties:
            volume_min:
              description: "Minimum loading volume percentage."
              type: integer
            volume_max:
              description: "Maximum loading volume percentage."
              type: integer
            capacity_min:
              description: "Minimum packages capacity."
              type: integer
            capacity_max:
              description: "Maximum packages capacity."
              type: integer
        route_limits:
          description: Route restrictions
          type: object
          properties:
            stops_min:
              description: "Minimum required stops."
              type: integer
            stops_max:
              description: "Maximum required stops."
              type: integer
            length_min:
              description: "Minimum distance for a delivery route."
              type: integer
            length_max:
              description: "Maximum distance for a delivery route."
              type: integer
            length_unit:
              description: "Distance unit."
              $ref: "components.yaml#/components/types/length_unit"
            time_min:
              description: "Minimum delivery route time."
              type: integer
            time_max:
              description: "Maximum delivery route time."
              type: integer
            time_unit:
              description: "Time unit."
              $ref: "components.yaml#/components/types/time_unit"

    delivery_lot_submit_only:
      description: Submit-Only Delivery Lot Entity Definition
      type: object
      properties:
        milestone_id:
          description: "Location from which the deliveries will depart."
          type: integer
        deliveries:
          description: "List of deliveries in the lot."
          type: array
          items:
            type: integer
        fleet_id:
          description: "Fleet designated for distribution."
          type: integer
        drivers:
          description: "List of drivers designated for distribution tasks."
          type: array
          items:
            type: integer

    delivery_lot_response_only:
      description: Response-Only Delivery Lot Entity Definition
      type: object
      properties:
        milestone:
          description: "Location from which the deliveries will depart."
          $ref: "milestones.yaml#/components/schemas/milestone_get"
        deliveries:
          description: "List of deliveries in the lot."
          type: array
          items:
            $ref: "deliveries.yaml#/components/schemas/delivery_get"
        fleet:
          description: "Fleet designated for distribution."
          $ref: "fleets.yaml#/components/schemas/fleet_get"
        drivers:
          description: "List of drivers designated for distribution tasks."
          type: array
          items:
            $ref: "drivers.yaml#/components/schemas/driver_get"
        state:
          description: "Current status of the delivery lot."
          type: string
          enum:
            - UNPROCESSED
            - PROCESSING
            - PROCESSED
            - CANCELED

    delivery_lot_get:
      description: HTTP GET Delivery Lot Entity Definition
      required:
        - id
        - milestone
        - deliveries
        - state
      allOf:
        - $ref: "components.yaml#/components/schemas/entity_id"
        - $ref: "#/components/schemas/delivery_lot_response_only"
        - $ref: "#/components/schemas/delivery_lot_base"

    delivery_lot_patch:
      description: HTTP PATCH Delivery Lot Entity Definition
      allOf:
        - $ref: "#/components/schemas/delivery_lot_submit_only"
        - $ref: "#/components/schemas/delivery_lot_base"

    delivery_lot_post:
      description: HTTP POST Delivery Lot Entity Definition
      required:
        - milestone_id
        - deliveries
      allOf:
        - $ref: "#/components/schemas/delivery_lot_patch"

    delivery_path_response_only:
      description: Response-Only Delivery Path Entity Definition
      type: object
      required:
        - milestone
        - delivery_units
      properties:
        milestone:
          description: "Location from which the delivery will depart."
          $ref: "milestones.yaml#/components/schemas/milestone_get"
        vehicle:
          description: "Vehicle that will be used for the delivery."
          $ref: "vehicles.yaml#/components/schemas/vehicle_get"
        driver:
          description: "Driver assigned to the delivery."
          $ref: "drivers.yaml#/components/schemas/driver_get"
        delivery_units:
          description: "List of items to be delivered."
          type: array
          items:
            $ref: "deliveries.yaml#/components/schemas/delivery_get"

    delivery_plan_response_only:
      description: Response-Only Delivery Plan Entity Definition
      type: object
      required:
        - delivery_lot_id
        - delivery_paths
      properties:
        delivery_lot_id:
          description: "Delivery lot from which the plan is created."
          type: integer
        delivery_paths:
          description: "List of delivery paths."
          type: array
          items:
            $ref: "#/components/schemas/delivery_path_response_only"

    delivery_plan_get:
      description: HTTP GET Delivery Plan Entity Definition
      allOf:
        - $ref: "#/components/schemas/delivery_plan_response_only"

  responses:

    delivery_lot:
      description: A delivery lot successfully retrieved.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/delivery_lot_get"
          examples:
            $ref: "delivery-lots_examples.yaml#/lot/200"

    delivery_lot_list:
      description: A list of delivery lots successfully retrieved.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: "#/components/schemas/delivery_lot_get"
          examples:
            $ref: "delivery-lots_examples.yaml#/list/200"

    delivery_plan:
      description: A delivery plan successfully retrieved.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/delivery_plan_get"
          examples:
            $ref: "delivery-lots_examples.yaml#/plan/200"


# ==========================
# Delivery Lots Paths (CRUD)
# ==========================

paths:

  /lots:
    summary: Operations related to delivery lots.
    description: This endpoint allows you to create, retrieve, update, and delete delivery lots.

    get:
      operationId: delivery-lots-get
      tags: [ delivery-lots ]
      summary: Retrieve all delivery lots.
      description: Returns a list of all delivery lots.
      responses:
        "200":
          $ref: "#/components/responses/delivery_lot_list"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

    post:
      operationId: delivery-lots-post
      tags: [ delivery-lots ]
      summary: Create a new delivery lot.
      description: Creates a new delivery lot with the provided information.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/delivery_lot_post"
            examples:
              $ref: "delivery-lots_examples.yaml#/request/create"
      responses:
        "201":
          description: Delivery lot successfully created.
          headers:
            Location:
              $ref: "components.yaml#/components/headers/created_url"
          $ref: "#/components/responses/delivery_lot"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

  /lots/{id}:
    parameters:
      - $ref: "components.yaml#/components/parameters/path_id"

    get:
      operationId: delivery-lots-id-get
      tags: [ delivery-lots ]
      summary: Retrieve a delivery lot by its ID.
      description: Returns a single delivery lot based on the provided ID.
      responses:
        "200":
          description: Delivery lot successfully retrieved.
          $ref: "#/components/responses/delivery_lot"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

    patch:
      operationId: delivery-lots-id-put
      tags: [ delivery-lots ]
      summary: Update an existing delivery lot.
      description: Updates an existing delivery lot with the provided ID and information.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/delivery_lot_patch"
            examples:
              $ref: "delivery-lots_examples.yaml#/request/update"
      responses:
        "200":
          description: Delivery lot successfully updated.
          $ref: "#/components/responses/delivery_lot"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

    delete:
      operationId: delivery-lots-id-delete
      tags: [ delivery-lots ]
      summary: Delete a delivery lot.
      description: Deletes the delivery lot with the provided ID.
      responses:
        "200":
          description: Delivery lot successfully deleted.
          $ref: "components.yaml#/components/responses/ok"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

  /lots/{id}/plan:
    parameters:
      - $ref: "components.yaml#/components/parameters/path_id"

    get:
      operationId: delivery-lots-plan-get
      tags: [ delivery-lots ]
      summary: Retrieve the delivery plan for a delivery lot.
      description: Returns the delivery plan associated with a specific delivery lot ID.
      responses:
        "200":
          description: Delivery plan successfully retrieved.
          $ref: "#/components/responses/delivery_plan"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

    post:
      operationId: delivery-lots-plan-post
      tags: [ delivery-lots ]
      summary: Generate/Update the delivery plan for a delivery lot.
      description: Generates or updates the delivery plan based on the delivery lot details.
      responses:
        "202":
          description: Delivery plan successfully created/updated.
          $ref: "components.yaml#/components/responses/ok"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"
