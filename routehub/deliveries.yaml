# =====================
# Deliveries Components
# =====================

components:

  types:

    packaging:
      type: string
      description: |
        * BOX: Rigid packaging made of cardboard or wood.
        * ENVELOPE: Flat paper container for documents or mail.
        * BAG: Flexible container for carrying or holding goods.
        * CARTON: Lightweight containers made from paperboard.
        * PALLET: Flat platform for transport & storage of goods.
        * SHRINK_WRAP: Plastic film for securing items.
      enum:
        - BOX
        - ENVELOPE
        - BAG
        - CARTON
        - PALLET
        - SHRINK_WRAP

    handling:
      type: string
      description: |
        * FRAGILE: Handle with care, contents easily broken.
        * PERISHABLE: Goods that require to remain fresh, such as food or pharmaceuticals.
        * HAZARDOUS: Dangerous goods, handle with extreme caution.
        * REFRIGERATED: Items that need to be kept at low temperatures at all times.
      enum:
        - FRAGILE
        - PERISHABLE
        - HAZARDOUS
        - REFRIGERATED

  schemas:

    delivery_base:
      description: Base Delivery Entity Definition
      type: object
      properties:
        delivery_method:
          type: string
          enum:
            - DELIVERY
            - PICKUP
            - SIGNATURE
        destination:
          description: "ISO 6709:DD (Standard representation of geographic point location by coordinates)"
          type: string
        schedules:
          description: "List of delivery schedules"
          type: array
          items:
            description: "RFC 5545 (iCalendar: Internet Calendaring and Scheduling Core Object Specification)"
            type: string
        width:
          type: number
        height:
          type: number
        depth:
          type: number
        length_unit:
          $ref: "components.yaml#/components/types/length_unit"
        volume:
          type: number
        volume_unit:
          $ref: "components.yaml#/components/types/volume_unit"
        weight:
          type: number
        weight_unit:
          $ref: "components.yaml#/components/types/weight_unit"
        packaging:
          $ref: "#/components/types/packaging"
        handling:
          type: array
          items:
            $ref: "#/components/types/handling"
        value_cents:
          type: integer
        value_currency:
          description: "ISO 4217 code"
          type: string
        extra:
          type: string

    delivery_submit_only:
      description: Submit-Only Delivery Entity Definition
      type: object
      properties:
        milestone_id:
          type: integer

    delivery_response_only:
      description: Response-Only Delivery Entity Definition
      type: object
      properties:
        milestone:
          $ref: "milestones.yaml#/components/schemas/milestone_get"

    delivery_get:
      description: HTTP GET Delivery Entity Definition
      required:
        - id
      allOf:
        - $ref: "components.yaml#/components/schemas/id_number"
        - $ref: "#/components/schemas/delivery_base"
        - $ref: "#/components/schemas/delivery_response_only"

    delivery_patch:
      description: HTTP PATCH Delivery Entity Definition
      allOf:
        - $ref: "#/components/schemas/delivery_base"
        - $ref: "#/components/schemas/delivery_submit_only"

    delivery_post:
      description: HTTP POST Delivery Entity Definition
      allOf:
        - $ref: "#/components/schemas/delivery_patch"

  responses:

    delivery:
      description: A delivery successfully retrieved.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/delivery_get"
          examples:
            $ref: "deliveries_examples.yaml#/unit/200"

    delivery_list:
      description: A list of deliveries successfully retrieved.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: "#/components/schemas/delivery_get"
          examples:
            $ref: "deliveries_examples.yaml#/list/200"


# =======================
# Deliveries Paths (CRUD)
# =======================

paths:

  /deliveries:
    summary: Operations related to Deliveries.
    description: Allows retrieval and creation of delivery entities.

    get:
      operationId: deliveries-get
      tags: [ deliveries ]
      summary: Retrieve all deliveries.
      description: Retrieves a list of all delivery entities.
      responses:
        "200":
          $ref: "#/components/responses/delivery_list"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

    post:
      operationId: deliveries-post
      tags: [ deliveries ]
      summary: Create a new delivery.
      description: Creates a new delivery entity.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/delivery_post"
            examples:
              $ref: "deliveries_examples.yaml#/request/create"
      responses:
        "201":
          description: Delivery successfully created.
          headers:
            Location:
              $ref: "components.yaml#/components/headers/created_url"
          $ref: "#/components/responses/delivery"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

  /deliveries/{id}:
    parameters:
      - $ref: "components.yaml#/components/parameters/path_id_number"

    get:
      operationId: deliveries-id-get
      tags: [ deliveries ]
      summary: Retrieve a delivery by ID.
      description: Retrieves a specific delivery entity by its ID.
      responses:
        "200":
          description: Delivery successfully retrieved.
          $ref: "#/components/responses/delivery"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

    patch:
      operationId: deliveries-id-put
      tags: [ deliveries ]
      summary: Update a delivery by ID.
      description: Updates an existing delivery entity identified by its ID.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/delivery_patch"
            examples:
              $ref: "deliveries_examples.yaml#/request/update"
      responses:
        "200":
          description: Delivery successfully updated.
          $ref: "#/components/responses/delivery"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"

    delete:
      operationId: deliveries-id-delete
      tags: [ deliveries ]
      summary: Delete a delivery by ID.
      description: Deletes a specific delivery entity identified by its ID.
      responses:
        "200":
          description: Delivery successfully deleted.
          $ref: "components.yaml#/components/responses/ok"
        "404":
          $ref: "components.yaml#/components/responses/notfound"
        "401":
          $ref: "components.yaml#/components/responses/unauthorized"
